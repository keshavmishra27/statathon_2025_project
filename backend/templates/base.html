<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
      <title>{% block title %}{% endblock %}</title>
      <style>
         /* ---------- Base Theme ---------- */
         body {
            background: linear-gradient(120deg, #0f0f0f, #1a1a1a);
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
         }

         main {
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
         }
         body.loaded main {
            opacity: 1;
         }

         /* ---------- Navbar ---------- */
         .navbar {
            background: linear-gradient(to right, #0d0d0d, #1c1c1c);
            box-shadow: 0 2px 10px rgba(0,0,0,0.6);
            padding: 0.8rem 1.2rem;
         }
         .navbar-brand {
            font-weight: bold;
            color: #00bfff !important;
            font-size: 1.4rem;
         }
         .navbar-nav .nav-link {
            color: #e0e0e0 !important;
            transition: color 0.3s ease, transform 0.2s ease;
         }
         .navbar-nav .nav-link:hover {
            color: #00bfff !important;
            transform: scale(1.05);
         }
         .navbar-nav .nav-link.active {
            color: #00ffff !important;
         }

         /* ---------- Flash Messages ---------- */
         .alert {
            backdrop-filter: blur(6px);
            background-color: rgba(255, 255, 255, 0.08);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 0.5rem;
            font-weight: 500;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.2);
         }

         /* ---------- Buttons ---------- */
         .btn {
            border-radius: 0.5rem;
            padding: 0.5rem 1.2rem;
            background: #00bfff;
            border: none;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
         }
         .btn:hover {
            background: #007acc;
            transform: translateY(-1px);
         }

         /* ---------- Scrollbar ---------- */
         ::-webkit-scrollbar {
            width: 8px;
         }
         ::-webkit-scrollbar-track {
            background: #1a1a1a;
         }
         ::-webkit-scrollbar-thumb {
            background: #00bfff;
            border-radius: 10px;
         }

         /* ---------- Loader ---------- */
         #page-loader {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(10, 10, 10, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.4s ease, visibility 0.4s ease;
         }
         #page-loader.hidden {
            opacity: 0;
            visibility: hidden;
         }
         .loader-ring {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 6px solid transparent;
            border-top: 6px solid #00f2fe;
            border-right: 6px solid #4facfe;
            animation: spin 1s linear infinite, glow 1.5s ease-in-out infinite alternate;
         }
         @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
         }
         @keyframes glow {
            0% { box-shadow: 0 0 5px #00f2fe; }
            100% { box-shadow: 0 0 20px #4facfe; }
         }
      </style>
   </head>
   <body>
      <!-- Loader -->
      <div id="page-loader">
         <div class="loader-ring"></div>
      </div>

      <!-- Navbar -->
      <nav class="navbar navbar-expand-md navbar-dark bg-dark">
         <a class="navbar-brand" href="#">Data Processing And Analysis</a>
         <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
         </button>
         <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mr-auto">
               <li class="nav-item active"><a class="nav-link" href="{{ url_for('app_blueprint.home_page') }}">Home</a></li>
               <li class="nav-item active"><a class="nav-link" href="{{ url_for('app_blueprint.upload_page') }}">Upload</a></li>
               <li class="nav-item"><a class="nav-link" href="{{ url_for('app_blueprint.leaderboard_page') }}">Leaderboard</a></li>
               <li class="nav-item"><a class="nav-link" href="{{ url_for('app_blueprint.analyze') }}">Analyze</a></li>
            </ul>
            {% if current_user.is_authenticated %}
            <ul class="navbar-nav">
               <li class="nav-item"><a class="nav-link" style="color:lawngreen; font-weight: bold;"><i class="fas fa-coins"></i> {{ current_user.prettier_budget }}</a></li>
               <li class="nav-item"><a class="nav-link">Welcome, {{ current_user.username }}</a></li>
               <li class="nav-item"><a class="nav-link" href="{{ url_for('app_blueprint.logout_page') }}">Logout</a></li>
            </ul>
            {% else %}
            <ul class="navbar-nav">
               <li class="nav-item"><a class="nav-link" href="{{ url_for('app_blueprint.login_page') }}">Login</a></li>
               <li class="nav-item"><a class="nav-link" href="{{ url_for('app_blueprint.register_page') }}">Register</a></li>
            </ul>
            {% endif %}
         </div>
      </nav>

      <!-- Flash messages -->
      <div class="container mt-4">
         {% with messages = get_flashed_messages(with_categories=true) %}
         {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} shadow-glow">
               <button type="button" class="close" data-dismiss="alert" aria-label="close"><span aria-hidden="true">&times;</span></button>
               {{ message }}
            </div>
            {% endfor %}
         {% endif %}
         {% endwith %}
      </div>

      <!-- Page content -->
      <main>
         {% block content %}{% endblock %}
      </main>

      <script src='https://kit.fontawesome.com/a076d05399.js'></script>
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

      <script>
         // Loader hide on page load
         window.addEventListener("load", () => {
            document.getElementById("page-loader").classList.add("hidden");
            document.body.classList.add("loaded");
         });

         // Show loader on navigation
         document.querySelectorAll("a").forEach(link => {
            if (link.getAttribute("target") !== "_blank" && link.href) {
               link.addEventListener("click", e => {
                  if (link.href.indexOf("#") === -1 && !link.classList.contains("no-loader")) {
                     document.getElementById("page-loader").classList.remove("hidden");
                     document.body.classList.remove("loaded");
                  }
               });
            }
         });

         // Show loader on form submit
         document.querySelectorAll("form").forEach(form => {
            form.addEventListener("submit", () => {
               document.getElementById("page-loader").classList.remove("hidden");
               document.body.classList.remove("loaded");
            });
         });
      </script>
   </body>
</html>
